---
title: "R Notebook"
output: html_notebook
---

# DATABASE

Construction & exploitation de la base de données


## library nécéssaires par la suite 

```{r}
library("dplyr")
library("readr")
library("ggplot2")
library("ggplot2")
library("ggthemes")
library("leaflet")
#je fais un comentaire qui ne sert à riuen 

getwd()

```


## construction full_base : juste un join de nos bases 

```{r}
stop_times <- read.csv("DATA/RATP_GTFS_FULL/stop_times.txt")

routes <- read.csv("DATA/RATP_GTFS_FULL/routes.txt")

stops <- read.csv("DATA/RATP_GTFS_FULL/stops.txt")

trips <- read.csv("DATA/RATP_GTFS_FULL/trips.txt")


full_base <- routes %>% 
  full_join( trips, id = "route_id") %>%
  full_join ( stop_times, id = "trip_id") %>%
  full_join( stops, id = "stop_id")

View(full_base)


```


## fonction save_as_csv : pour sauvegarder cette base 

```{r eval=FALSE}
library(assertthat)
library(utils)

save_as_csv <- function(dataset, filename, row.names = FALSE, ...){
  assert_that(has_extension(filename,"csv"))
  assert_that(is.dir(dirname(filename)))
  assert_that(is.writeable(dirname(filename)))
  assert_that(not_empty(dataset))
  assert_that(is.data.frame(dataset))

  write.csv2( x = dataset, file  = filename, row.names = row.names, ...)

  invisible(normalizePath(filename))

}

\dontrun{save_as_csv( full_base, "full_base.csv")}

```


## construction base_metro : on ne garde que le RER et le métro (suppression des lignes qui concernent le bus, tram... )

```{r eval= FALSE}
base_metro <-full_base %>%
  filter( route_type == 1 | route_type == 2) %>%
  subset(select = -c(agency_id, route_text_color, route_desc, route_url,route_color, route_text_color, trip_headsign, shape_id, stop_headsign, shape_dist_traveled, stop_code, parent_station))

View(base_metro)

\dontrun{save_as_csv(base_metro, "base_metro.csv")}


```


## Construction de la base métro map : garde une station par ligne (plus 50000 lignes pour tous les départs de Villepinte, mais une seule). En revanche, charles de gaulle étoile: 4 fois, pour le rer A, la 1, la 2 et la 6 

```{r}
base_metro_map <- base_metro %>%
  distinct(stop_name, route_short_name, .keep_all = TRUE)
View(base_metro_map)
```

